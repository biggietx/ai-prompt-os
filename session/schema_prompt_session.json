{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Prompt OS Session Log",
  "description": "Schema for governed prompt session recordings.",
  "type": "object",
  "required": [
    "timestamp_utc",
    "prompt_os_version",
    "prompts_used",
    "developer",
    "target_repo",
    "notes",
    "lint_passed"
  ],
  "properties": {
    "timestamp_utc": {
      "type": "string",
      "description": "UTC timestamp in ISO-8601 format.",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"
    },
    "prompt_os_version": {
      "type": "string",
      "description": "Prompt OS version tag (e.g., v0.3.0)."
    },
    "prompts_used": {
      "type": "array",
      "description": "List of prompt IDs used in this session.",
      "items": {
        "type": "string",
        "pattern": "^P\\d{2}$"
      },
      "minItems": 1
    },
    "developer": {
      "type": "string",
      "description": "Name of the developer who ran the session.",
      "minLength": 1
    },
    "target_repo": {
      "type": "string",
      "description": "Name of the repository the session was run against.",
      "minLength": 1
    },
    "notes": {
      "type": "string",
      "description": "Optional session notes."
    },
    "lint_passed": {
      "type": "boolean",
      "description": "Whether prompt lint passed before session recording."
    },
    "pas": {
      "type": "object",
      "description": "Optional PAS stack binding. Present only when session used a PAS stack.",
      "required": ["stack_id", "stack_version", "compiled_hash"],
      "properties": {
        "stack_id": {
          "type": "string",
          "description": "PAS stack ID that was compiled.",
          "minLength": 1
        },
        "stack_version": {
          "type": "string",
          "description": "Version of the PAS stack at compile time."
        },
        "compiled_hash": {
          "type": "string",
          "description": "SHA-256 hash of the compiled prompt output.",
          "pattern": "^[a-f0-9]{64}$"
        }
      },
      "additionalProperties": false
    },
    "artifact_hash": {
      "type": "string",
      "description": "SHA-256 hash of the base session JSON (before chain fields)."
    },
    "chain_hash": {
      "type": "string",
      "description": "SHA-256 hash of artifact_hash concatenated with timestamp_utc."
    }
  },
  "additionalProperties": false
}
