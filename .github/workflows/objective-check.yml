name: Objective Compliance Check

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-objective:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Title and Description for Objective Compliance
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const title = pr.title || "";
            const body = pr.body || "";

            const hasObjectiveId = /(?:^|\s|\[)([A-Z]+-(?:V1|V2|EXP|FIX)-\d{3})(?:\]|\s|$)/.test(title);

            const hasChecklist =
              body.includes("### Objective") &&
              body.includes("- [ ] I mapped this PR to **") &&
              body.includes("LOGS/DAILY/") &&
              body.includes("STRATEGY.md") &&
              body.includes("### Summary") &&
              body.includes("### Test plan") &&
              body.includes("### Risks / roll-back");

            if (!hasObjectiveId) {
              core.setFailed("PR title must include an Objective ID like CORE-V1-001.");
            }

            if (!hasChecklist) {
              core.setFailed("PR body must include the required Objective/Summary/Test plan/Risks block.");
            }
